# BCS CTF 2025 noisy_shark writeup

## Discovering something hidden in the output
We are given a binary file with a netcat communication.


Then if we do,
```bash
nc $host $port > out.txt
cat out.txt
```

We will see some extra 00s and 07s
```bash 
>>> xxd -p out.txt 
57656c636f6d6520746f20746865204e6f69737920536861726b212e2e2e
0a576861742073797374656d20697320436f727275707465642e2e2e2121
21210a5768792074686973206f63637572656420736f756e64732e2e2e0a
596f7520616c736f20686561722069742072696768743f2e2e2e0a4f6821
2049206b6e6f772e2e2e20497427732074686520536861726b2e2e2e0a48
652048652e2e2e205768617420697320596f75722047756573733f0a0700
070007070700070000000700070707000700070000000700070707000000
070707000707070007000000000000000700070000000700070007000000
000000000707070007070700070707000700070007000000000000000707
070007000700070000000707070007000707070007000000070007000700
000007070700070007070700070000000707070000000700070007070700
070000000700070007070700070707000707070000000707070007070700
070707000707070007070700000007000700070707000707070007070700
000007000700070007000700000007070700070007070700070707000700
000007070700070000000707070007070700070707000000070007070700
070707000707070007070700000007000700070000000700070007000707
070007070700000007000700070707000707070007000707070000000700
070707000700070000000700070707000707070007070700070707000000
070707000700070707000000070007000700070707000707070000000700
070007070700070707000700070707000000070007070700000007000700
070707000707070007000707070000000707070007070700000007070700
070707000707070007070700070707000000070007070700070000000700
070007000000070007000700070707000707070000000700070007000707
070007070700000007000700070707000707070007000707070000000707
070007000707070007000000070707000707070007070700070707000707
070000000707070007070700070707000707070007070700000007070700
070007000000070007000700070707000707070000000707070007000707
070007000707070007070700000007070700070007070700070707000700
070707000000
```

This should directly correlate with the flag.txt file it opens during execution.

## Reversing the binary
The challenging part is that this binary is stripped and it is not easy to find its' codes that we care about.

All i did was Ctrl+F and then type "flag.txt". Then we check its references and set a breakpoint there and continue with the execution.

There are a lot of unnamed functions which makes the code very hard to read.

But i stumble to an interesting function that outputs the 0s and 7s.

And that is, ```sub4063c1()```

And this decompiled code snippet there is useful.

```c
00000000004062f2                  if (r14_3 != r12_2)
0000000000406342                      do
0000000000406349                          if (*r12_2 != 0x2d)
0000000000406308                              sender(&data_..,7)
0000000000406310                              sub_458470()
000000000040631a                              sub_517170()
0000000000406349                          else
000000000040634b                              int32_t i_4 = 3
0000000000406372                              int32_t i_1
0000000000406372                              
0000000000406372                              do
0000000000406358                                  sender(&data_..,7)
0000000000406360                                  sub_458470()
000000000040636a                                  sub_517170()
000000000040636f                                  i_1 = i_4
000000000040636f                                  i_4 -= 1
0000000000406372                              while (i_1 != 1)
0000000000406372                          
0000000000406324                          r12_2 = &r12_2[1]
0000000000406328                          sender(&data_..,0)
0000000000406330                          sub_458470()
000000000040633a                          sub_517170()
0000000000406342                      while (r14_3 != r12_2)
0000000000406342                  
0000000000406385                  sender(&data_..,0)
000000000040638d                  sub_458470()
0000000000406397                  sub_517170()
00000000004063a1                  sender(&data_..,0)
00000000004063a9                  sub_458470()
00000000004063b3                  sub_517170()
00000000004063b3                  break

```

Here sender returns arg2 and sub_458470() returns 0. This was found through debugging and looking carefully at the output.

Also at this address, 0x5c5460, All the necessary morse code translations of all character were given.

### Summary of the code

A string is constructed with the structure ```flag is : <contents of flag.txt>```
The previous code of that snippet transforms the Letter to its corresponding morse code. 
Then the following transformation happens - 
```
"-"     ----> "70707000"
"."     ----> "7000"
" "     ----> "0000"
```  
### Decode script
Now this python code decodes the morse code of the flag.
```python
def parse_string(input_string):
    patterns = {
        "707000": "-",
        "7000": ".",
        "0000": " "
    }
    output = ""
    i = 0
    while i < len(input_string):
        matched = False
        for pattern, replacement in patterns.items():
            if input_string[i:i+len(pattern)] == pattern:
                output += replacement
                i += len(pattern)
                matched = True
                break
        if not matched:
            i += 1
    return output

inputt = "700070007070700070000000700070707000700070000000700070707000000070707000707070007000000000000000700070000000700070007000000000000000707070007070700070707000700070007000000000000000707070007000700070000000707070007000707070007000000070007000700000007070700070007070700070000000707070000000700070007070700070000000700070007070700070707000707070000000707070007070700070707000707070007070700000007000700070707000707070007070700000007000700070007000700000007070700070007070700070707000700000007070700070000000707070007070700070707000000070007070700070707000707070007070700000007000700070000000700070007000707070007070700000007000700070707000707070007000707070000000700070707000700070000000700070707000707070007070700070707000000070707000700070707000000070007000700070707000707070000000700070007070700070707000700070707000000070007070700000007000700070707000707070007000707070000000707070007070700000007070700070707000707070007070700070707000000070007070700070000000700070007000000070007000700070707000707070000000700070007000707070007070700000007000700070707000707070007000707070000000707070007000707070007000000070707000707070007070700070707000707070000000707070007070700070707000707070007070700000007070700070007000000070007000700070707000707070000000707070007000707070007000707070007070700000007070700070007070700070707000700070707000000"

print(parse_string(inputt))

```

Now we can put the code into cyberchef using "From Morse Code" recipe and we get the flag.